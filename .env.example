# ============================================================================
# ECCS Platform Environment Configuration
# ============================================================================
# This file contains all environment variables for the ECCS platform.
# Copy this file to .env and configure the values for your environment.
#
# USAGE:
#   cp .env.example .env
#   # Edit .env with your configuration
#   ./scripts/start.sh
#
# SECURITY NOTES:
#   - NEVER commit .env to version control
#   - Use strong, unique passwords for all services
#   - In production, use secrets management (Vault, K8s secrets, etc.)
#   - Rotate credentials regularly
# ============================================================================

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL Configuration
# Used by: auth-service, email-service
# SECURITY: Use a strong password (min 16 characters, mixed case, numbers, symbols)
POSTGRES_PASSWORD=your_secure_postgres_password_here

# ============================================================================
# AUTHENTICATION
# ============================================================================

# JWT Secret Key
# Used by: auth-service, email-service (for token verification)
# SECURITY: Use a cryptographically strong random string (min 32 characters)
# Generate with: openssl rand -base64 32
JWT_SECRET=your-super-secret-jwt-key-change-in-production

# JWT Token Expiration (optional, defaults to 1h)
# Shorter expiration = more secure but more frequent refreshes
# JWT_EXPIRATION=1h

# ============================================================================
# EMAIL PROVIDER CONFIGURATION
# ============================================================================
# The notification-service supports multiple email providers.
# Set EMAIL_PROVIDER to one of: smtp, ses, sendgrid

# Email Provider Selection (default: smtp)
# Options: smtp, ses, sendgrid
EMAIL_PROVIDER=smtp

# ----------------------------------------------------------------------------
# Mailpit - Development SMTP Server (Default for Development)
# ----------------------------------------------------------------------------
# By default, the platform uses Mailpit as the SMTP server for development.
# Mailpit captures all emails without sending them, perfect for testing.
#
# Web UI: http://localhost:8025 (view all captured emails)
# SMTP: mailpit:1025 (no authentication required)
#
# The defaults below work with the Mailpit container included in the stack.
# For production, override these values with your actual SMTP server.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# SMTP Configuration (EMAIL_PROVIDER=smtp)
# ----------------------------------------------------------------------------
# Works with any SMTP server including Gmail, Outlook, Mailgun, etc.
# Default values use Mailpit for development - override for production
SMTP_HOST=mailpit
SMTP_PORT=1025
SMTP_USER=
SMTP_PASS=
SMTP_FROM=noreply@eccs.example
SMTP_FROM_NAME=ECCS Email Service

# ----------------------------------------------------------------------------
# Production SMTP Configuration Example
# ----------------------------------------------------------------------------
# Uncomment and configure for production SMTP server:
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USER=user@example.com
# SMTP_PASS=your_smtp_password
# SMTP_FROM=noreply@example.com

# SMTP Security (optional)
# Set to 'true' for port 465, 'false' for port 587 with STARTTLS
# SMTP_SECURE=false

# ----------------------------------------------------------------------------
# AWS SES Configuration (EMAIL_PROVIDER=ses)
# ----------------------------------------------------------------------------
# For high-volume email sending with AWS SES SMTP interface
# Generate SMTP credentials in AWS SES Console > SMTP Settings
# AWS_REGION=us-east-1
# AWS_SES_SMTP_USER=your_ses_smtp_username
# AWS_SES_SMTP_PASS=your_ses_smtp_password
# SES_FROM_EMAIL=verified-sender@example.com

# ----------------------------------------------------------------------------
# SendGrid Configuration (EMAIL_PROVIDER=sendgrid)
# ----------------------------------------------------------------------------
# For SendGrid email API
# SENDGRID_API_KEY=your_sendgrid_api_key
# SENDGRID_FROM_EMAIL=noreply@example.com

# ============================================================================
# RETRY POLICY CONFIGURATION
# ============================================================================
# Exponential backoff configuration for failed email delivery attempts

# Maximum number of retry attempts before sending to DLQ (default: 5)
MAX_RETRY_ATTEMPTS=5

# Base delay for exponential backoff in milliseconds (default: 1000)
# Actual delay = BASE_RETRY_DELAY * (2 ^ attemptNumber)
BASE_RETRY_DELAY=1000

# Maximum delay cap in milliseconds (default: 60000 = 1 minute)
MAX_RETRY_DELAY=60000

# ============================================================================
# MONITORING
# ============================================================================

# Grafana Admin Password
# SECURITY: Change this from the default in production!
GRAFANA_PASSWORD=your_grafana_admin_password

# ============================================================================
# MESSAGE QUEUE
# ============================================================================

# Kafka Configuration
# Used by: email-service, notification-service
KAFKA_BROKERS=kafka:9092

# Kafka Consumer Group (optional)
KAFKA_GROUP_ID=notification-group

# ============================================================================
# LOGGING
# ============================================================================

# MongoDB URI
# Used by: email-service, notification-service (for logging)
MONGODB_URI=mongodb://mongodb:27017/eccs_logs

# Log Level (optional, defaults to 'info')
# Options: error, warn, info, http, debug
LOG_LEVEL=info

# ============================================================================
# CONTAINER RUNTIME
# ============================================================================

# NOTE: Docker provider is disabled in Traefik to avoid permission issues
# with Podman socket access. All routing is handled via the file provider.
# If you need to re-enable Docker provider for dynamic service discovery,
# configure the socket path below and update traefik configuration.
#
# Container Socket Path (only needed if Docker provider is re-enabled)
# For Podman (rootless): /run/user/1000/podman/podman.sock
# For Podman (rootful): /run/podman/podman.sock
# For Docker: /var/run/docker.sock
# CONTAINER_SOCK=/var/run/docker.sock

# ============================================================================
# TRACING (Optional)
# ============================================================================

# Jaeger Configuration
# JAEGER_ENDPOINT=http://jaeger:14268/api/traces
# JAEGER_AGENT_HOST=jaeger
# JAEGER_AGENT_PORT=6831

# ============================================================================
# PROXY CONFIGURATION
# ============================================================================
# If your environment requires an HTTP proxy for external network access,
# configure these variables. Note: Internal service-to-service communication
# is automatically configured to bypass the proxy in podman-compose.yml.
#
# IMPORTANT: The no_proxy/NO_PROXY variable is pre-configured in the Traefik
# service to include all internal container service names. This ensures that
# health checks and ForwardAuth requests (JWT verification) go directly to
# containers instead of through an external proxy that cannot resolve
# internal DNS names like auth-service, email-service, etc.
#
# http_proxy=http://proxy.example.com:3128
# https_proxy=http://proxy.example.com:3128
# no_proxy=localhost,127.0.0.1,::1

# ============================================================================
# PRODUCTION OVERRIDES
# ============================================================================

# Uncomment and configure for production deployment:

# TLS/SSL Configuration
# TLS_CERT_PATH=/etc/ssl/certs/eccs.crt
# TLS_KEY_PATH=/etc/ssl/private/eccs.key

# External URLs
# FRONTEND_URL=https://app.example.com
# API_URL=https://api.example.com

# Node Environment
# NODE_ENV=production
