{
  "_comment": "============================================================================",
  "_comment2": "ECCS Logs Index Template - Applied to all eccs-logs-* and eccs-email-logs-* indices",
  "_comment3": "============================================================================",
  "_comment4": "This template defines field mappings for log data indexed from multiple sources:",
  "_comment5": "  1. Real-time logs from TCP/Beats inputs (eccs-logs-*)",
  "_comment6": "  2. Email processing logs from MongoDB (eccs-email-logs-*)",
  "_comment7": "",
  "_comment8": "INDEX PATTERNS:",
  "_comment9": "  - eccs-logs-*: General application logs from real-time ingestion",
  "_comment10": "  - eccs-email-logs-*: Email processing audit trail from MongoDB",
  "_comment11": "  - eccs-app-logs-*: Application events from MongoDB",
  "_comment12": "",
  "_comment13": "QUERY FILTER EXAMPLES:",
  "_comment14": "  Error Analysis:",
  "_comment15": "    - status:failed OR status:retry (find all errors)",
  "_comment16": "    - error_category:network (network-related failures)",
  "_comment17": "    - is_final_failure:true (dead letter queue entries)",
  "_comment18": "  Latency Analysis:",
  "_comment19": "    - latencyMs:[5000 TO *] (slow processing > 5s)",
  "_comment20": "    - latency_bucket:critical (critical latency alerts)",
  "_comment21": "    - sendLatencyMs:[3000 TO *] (slow SMTP operations)",
  "_comment22": "  Retry Analysis:",
  "_comment23": "    - is_retry:true (retried emails)",
  "_comment24": "    - attempt:[2 TO *] (multiple delivery attempts)",
  "_comment25": "    - sentToDlq:true (exhausted retries)",
  "_comment26": "============================================================================",
  "index_patterns": ["eccs-logs-*", "eccs-email-logs-*", "eccs-app-logs-*"],
  "priority": 200,
  "template": {
    "settings": {
      "number_of_shards": 1,
      "number_of_replicas": 0,
      "refresh_interval": "5s",
      "index.lifecycle.name": "eccs-logs-policy",
      "index.lifecycle.rollover_alias": "eccs-logs"
    },
    "mappings": {
      "dynamic": "true",
      "dynamic_templates": [
        {
          "strings_as_keywords": {
            "match_mapping_type": "string",
            "mapping": {
              "type": "keyword",
              "ignore_above": 1024
            }
          }
        }
      ],
      "properties": {
        "@timestamp": {
          "type": "date"
        },
        "timestamp": {
          "type": "date"
        },
        "message": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 256
            }
          }
        },
        "level": {
          "type": "keyword"
        },
        "service_name": {
          "type": "keyword"
        },
        "service": {
          "type": "keyword"
        },
        "service_type": {
          "type": "keyword"
        },
        "service_version": {
          "type": "keyword"
        },
        "traceId": {
          "type": "keyword"
        },
        "spanId": {
          "type": "keyword"
        },
        "userId": {
          "type": "keyword"
        },
        "emailId": {
          "type": "keyword"
        },
        "mongodb_id": {
          "type": "keyword"
        },
        "status": {
          "type": "keyword"
        },
        "errorMessage": {
          "type": "text",
          "fields": {
            "keyword": {
              "type": "keyword",
              "ignore_above": 512
            }
          }
        },
        "errorCode": {
          "type": "keyword"
        },
        "errorStack": {
          "type": "text"
        },
        "error_category": {
          "type": "keyword"
        },
        "latencyMs": {
          "type": "long"
        },
        "sendLatencyMs": {
          "type": "long"
        },
        "latency_bucket": {
          "type": "keyword"
        },
        "attempt": {
          "type": "integer"
        },
        "maxAttempts": {
          "type": "integer"
        },
        "is_retry": {
          "type": "boolean"
        },
        "is_final_failure": {
          "type": "boolean"
        },
        "sentToDlq": {
          "type": "boolean"
        },
        "provider": {
          "type": "keyword"
        },
        "email_provider": {
          "type": "keyword"
        },
        "messageId": {
          "type": "keyword"
        },
        "recipientEmail": {
          "type": "keyword"
        },
        "processedAt": {
          "type": "date"
        },
        "retryScheduledAt": {
          "type": "date"
        },
        "backoffDelayMs": {
          "type": "long"
        },
        "pipeline_version": {
          "type": "keyword"
        },
        "container": {
          "properties": {
            "name": {
              "type": "keyword"
            },
            "id": {
              "type": "keyword"
            }
          }
        },
        "host": {
          "properties": {
            "name": {
              "type": "keyword"
            }
          }
        },
        "error": {
          "properties": {
            "message": {
              "type": "text"
            },
            "type": {
              "type": "keyword"
            },
            "stack_trace": {
              "type": "text"
            }
          }
        },
        "http": {
          "properties": {
            "method": {
              "type": "keyword"
            },
            "status_code": {
              "type": "integer"
            },
            "url": {
              "type": "text",
              "fields": {
                "keyword": {
                  "type": "keyword"
                }
              }
            }
          }
        },
        "duration_ms": {
          "type": "long"
        },
        "client_ip": {
          "type": "ip"
        },
        "geoip": {
          "properties": {
            "city_name": {
              "type": "keyword"
            },
            "country_name": {
              "type": "keyword"
            },
            "location": {
              "type": "geo_point"
            }
          }
        },
        "metadata": {
          "type": "object",
          "enabled": true
        },
        "tags": {
          "type": "keyword"
        },
        "stats": {
          "type": "object",
          "enabled": true,
          "properties": {
            "sentToday": {
              "type": "long"
            },
            "totalEmails": {
              "type": "long"
            },
            "pending": {
              "type": "long"
            },
            "failed": {
              "type": "long"
            }
          }
        },
        "version": {
          "type": "keyword"
        }
      }
    }
  }
}
