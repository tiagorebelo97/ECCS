# ============================================================================
# JVM Options for ECCS Logstash
# ============================================================================
# This file contains JVM options for Logstash. Options can also be set via
# the LS_JAVA_OPTS environment variable.
#
# NOTE: Heap size settings (-Xms and -Xmx) can be configured via LS_JAVA_OPTS
# environment variable in podman-compose.yml. If both are set, environment
# variable takes precedence.
# ============================================================================

## JVM Configuration

# Heap size - can be overridden by LS_JAVA_OPTS environment variable
-Xms256m
-Xmx256m

################################################################
## Expert settings
################################################################
##
## All settings below this section are considered expert settings.
## Don't tamper with them unless you understand what you are doing.
##
################################################################

## GC Configuration
11-13:-XX:+UseConcMarkSweepGC
11-13:-XX:CMSInitiatingOccupancyFraction=75
11-13:-XX:+UseCMSInitiatingOccupancyOnly

## G1 GC settings for JDK 14+
14-:-XX:+UseG1GC

## DNS cache policy
## Logstash uses the JVM's DNS caching to speed up lookups. However, we
## should not cache forever.
-Des.networkaddress.cache.ttl=60
-Des.networkaddress.cache.negative.ttl=10

## Locale
# Set the locale to ensure consistent log formats
-Dfile.encoding=UTF-8

# Temporary directory
# NOTE: Use absolute path instead of ${LS_HOME} variable, which may not be
# expanded correctly and causes SQLite JDBC native library loading to fail
# with UnsatisfiedLinkError when path contains literal "${LS_HOME}".
-Djava.io.tmpdir=/tmp

# Disable JRuby invokedynamic on Java 11+
-Djruby.compile.invokedynamic=false

# Make sure InterruptibleChannel doesn't use legacy blocking mode
-Djdk.io.File.enableADS=true

# JRuby options for better regexp handling
-Djruby.regexp.interruptible=true

## heap dumps

# Generate heap dump on OOM
#-XX:+HeapDumpOnOutOfMemoryError

# Heap dump location
# NOTE: Use absolute path instead of ${LS_HOME} variable for consistency
#-XX:HeapDumpPath=/var/log/logstash/heapdump.hprof

# Specify an alternative path for JVM fatal error logs
# NOTE: Use absolute path instead of ${LS_HOME} variable for consistency
-XX:ErrorFile=/var/log/logstash/hs_err_pid%p.log

# Module access for Java 11+
--add-exports=jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED
--add-exports=jdk.compiler/com.sun.tools.javac.file=ALL-UNNAMED
--add-exports=jdk.compiler/com.sun.tools.javac.parser=ALL-UNNAMED
--add-exports=jdk.compiler/com.sun.tools.javac.tree=ALL-UNNAMED
--add-exports=jdk.compiler/com.sun.tools.javac.util=ALL-UNNAMED
--add-opens=java.base/java.security=ALL-UNNAMED
--add-opens=java.base/java.io=ALL-UNNAMED
--add-opens=java.base/java.nio.channels=ALL-UNNAMED
--add-opens=java.base/sun.nio.ch=ALL-UNNAMED
--add-opens=java.management/sun.management=ALL-UNNAMED
