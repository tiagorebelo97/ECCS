# ============================================================================
# Grafana Configuration for ECCS Platform
# ============================================================================
# Main Grafana configuration file with security, performance, and
# integration settings for the ECCS monitoring stack.
# ============================================================================

# -----------------------------------------------------------------------------
# Instance Settings
# -----------------------------------------------------------------------------
[instance]
name = ECCS Monitoring

# -----------------------------------------------------------------------------
# Server Settings
# -----------------------------------------------------------------------------
[server]
# Bind to all interfaces (required for container networking)
http_addr = 0.0.0.0
# HTTP port
http_port = 3000
# Domain (update for production)
domain = localhost
# Root URL (update if behind reverse proxy)
root_url = %(protocol)s://%(domain)s:%(http_port)s/
# Serve Grafana from subpath (if needed)
# serve_from_sub_path = true

# -----------------------------------------------------------------------------
# Database Settings
# -----------------------------------------------------------------------------
[database]
# Using SQLite for simplicity (use PostgreSQL in production)
type = sqlite3
path = grafana.db

# For PostgreSQL (production):
# type = postgres
# host = postgres:5432
# name = grafana
# user = grafana
# password = ${GF_DATABASE_PASSWORD}

# -----------------------------------------------------------------------------
# Security Settings
# -----------------------------------------------------------------------------
[security]
# Admin user (set via environment variable)
admin_user = ${GF_SECURITY_ADMIN_USER:admin}
# Admin password (set via environment variable - REQUIRED in production)
admin_password = ${GF_SECURITY_ADMIN_PASSWORD:admin}

# Secret key for signing (generate a unique key for production)
secret_key = ${GF_SECURITY_SECRET_KEY:SW2YcwTIb9zpOOhoPsMm}

# Disable gravatar
disable_gravatar = true

# Cookie settings
cookie_secure = false  # Set to true when using HTTPS
cookie_samesite = lax

# Content security policy
content_security_policy = true

# -----------------------------------------------------------------------------
# User Settings
# -----------------------------------------------------------------------------
[users]
# Disable user signup
allow_sign_up = false
# Allow organization creation
allow_org_create = false
# Auto-assign new users to default organization
auto_assign_org = true
auto_assign_org_id = 1
auto_assign_org_role = Viewer

# -----------------------------------------------------------------------------
# Authentication Settings
# -----------------------------------------------------------------------------
[auth]
# Disable login form (if using SSO only)
disable_login_form = false
# Disable signout menu
disable_signout_menu = false

[auth.anonymous]
# Disable anonymous access
enabled = false

# For LDAP authentication:
# [auth.ldap]
# enabled = true
# config_file = /etc/grafana/ldap.toml

# For OAuth (e.g., GitHub):
# [auth.github]
# enabled = true
# client_id = ${GF_AUTH_GITHUB_CLIENT_ID}
# client_secret = ${GF_AUTH_GITHUB_CLIENT_SECRET}

# -----------------------------------------------------------------------------
# Logging Settings
# -----------------------------------------------------------------------------
[log]
# Log mode (console, file, syslog)
mode = console
# Log level
level = info
# Log format (console, text, json)
format = json

[log.console]
format = json

# -----------------------------------------------------------------------------
# Alerting Settings
# -----------------------------------------------------------------------------
[alerting]
# Enable alerting engine
enabled = true
# Execute alerts
execute_alerts = true
# Error or timeout interval
error_or_timeout = alerting
# Evaluation timeout
evaluation_timeout_seconds = 30

[unified_alerting]
enabled = true

# -----------------------------------------------------------------------------
# SMTP Settings (for email alerts)
# -----------------------------------------------------------------------------
[smtp]
enabled = false
# host = smtp.example.com:587
# user = alerting@example.com
# password = ${GF_SMTP_PASSWORD}
# from_address = alerting@example.com
# from_name = ECCS Grafana

# -----------------------------------------------------------------------------
# Metrics Settings
# -----------------------------------------------------------------------------
[metrics]
enabled = true
interval_seconds = 10

# -----------------------------------------------------------------------------
# Plugins Settings
# -----------------------------------------------------------------------------
[plugins]
# Enable alpha plugins (not recommended for production)
enable_alpha = false
# Plugin catalog URL
plugin_catalog_url = https://grafana.com/grafana/plugins/

# -----------------------------------------------------------------------------
# Feature Toggles
# -----------------------------------------------------------------------------
[feature_toggles]
# Enable specific features
# enable = feature1,feature2

# -----------------------------------------------------------------------------
# Dashboard Settings
# -----------------------------------------------------------------------------
[dashboards]
# Versions to keep
versions_to_keep = 20

# -----------------------------------------------------------------------------
# Annotations Settings
# -----------------------------------------------------------------------------
[annotations.dashboard]
max_age = 0
max_annotations_to_keep = 0

# -----------------------------------------------------------------------------
# Explore Settings
# -----------------------------------------------------------------------------
[explore]
enabled = true

# -----------------------------------------------------------------------------
# Rendering Settings (for image export)
# -----------------------------------------------------------------------------
[rendering]
# Enable server-side rendering
# server_url = http://renderer:8081/render
# callback_url = http://grafana:3000/
