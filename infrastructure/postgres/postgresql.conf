# ============================================================================
# PostgreSQL Configuration for ECCS Platform
# ============================================================================
# This configuration is optimized for a containerized environment with
# moderate workloads. Adjust values based on available container resources.
#
# RESOURCE ALLOCATION:
#   - Memory: Assumes 512MB-1GB container memory limit
#   - CPU: Assumes 0.5-1 CPU cores
#   - Storage: SSD-optimized settings
#
# SECURITY SETTINGS:
#   - SSL/TLS connections supported
#   - Password authentication required
#   - Logging for audit compliance
# ============================================================================

# -----------------------------------------------------------------------------
# Connection Settings
# -----------------------------------------------------------------------------
# Listen on all interfaces (container networking)
listen_addresses = '*'
# Default port
port = 5432
# Maximum concurrent connections
max_connections = 100

# -----------------------------------------------------------------------------
# Memory Settings
# -----------------------------------------------------------------------------
# Shared memory for caching (25% of container memory)
shared_buffers = 128MB
# Memory for complex queries
work_mem = 4MB
# Memory for maintenance operations (vacuum, index creation)
maintenance_work_mem = 64MB
# Effective cache size (estimate of OS cache + shared_buffers)
effective_cache_size = 256MB

# -----------------------------------------------------------------------------
# Write-Ahead Log (WAL) Settings
# -----------------------------------------------------------------------------
# Checkpoint settings for durability vs performance balance
checkpoint_completion_target = 0.9
wal_buffers = 16MB
# WAL level for replication support (if needed later)
wal_level = replica

# -----------------------------------------------------------------------------
# Query Planner Settings
# -----------------------------------------------------------------------------
# Random page cost (lower for SSDs)
random_page_cost = 1.1
# Enable parallel query execution
max_parallel_workers_per_gather = 2
max_parallel_workers = 4

# -----------------------------------------------------------------------------
# Logging Settings
# -----------------------------------------------------------------------------
# Log destination
logging_collector = on
log_directory = 'pg_log'
log_filename = 'postgresql-%Y-%m-%d.log'
# Log slow queries (longer than 1 second)
log_min_duration_statement = 1000
# Log connection events for security auditing
log_connections = on
log_disconnections = on
# Log statement types
log_statement = 'ddl'

# -----------------------------------------------------------------------------
# Security Settings
# -----------------------------------------------------------------------------
# Password encryption algorithm
password_encryption = scram-sha-256
# SSL configuration (certificates must be provided)
# ssl = on
# ssl_cert_file = '/etc/ssl/certs/server.crt'
# ssl_key_file = '/etc/ssl/private/server.key'

# -----------------------------------------------------------------------------
# Timezone
# -----------------------------------------------------------------------------
timezone = 'UTC'
log_timezone = 'UTC'
